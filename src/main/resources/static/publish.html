<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>publish</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="./css/publish.css">
    <link rel="stylesheet" href="./font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">

    <script src="js/jquery-3.3.1.js"></script>
    <script>
        $(function () {
            $.get("/post/curuser", {}, function (curUser) {
                var lis = '';
                if (curUser.flag == false) {
                    lis += `<li>
                      <a href="login.html">用户登录</a>
                  </li>`

                } else {
                    lis += `<li>
                     你好，${curUser.data.username}
                  </li>
                  <li>
                      <a href="userPage.html">个人中心</a>
                  </li>
                  <li onclick="javascript:exit()">
                  <a href="javascript:void(0)">退出</a>
                   </li>`


                }
                $("#userInfo").html(lis);
            })

        })

        function exit() {
            $.get("/post/exit", {}, function (curUser) {
                if (curUser.flag == true) {
                    alert(curUser.message)
                    var lis = `<li>
                      <a href="login.html">用户登录</a>
                  </li>`
                    $("#userInfo").html(lis);
                }

            })
        }

        $(function () {
            $.get("/post/category", {}, function (data) {
                var lis = '<li ><a href="index.html?cid=' + data[0].cid + '">' + data[0].cname + '</a></li>'

                for (var i = 1; i < data.length; i++) {
                    lis += '<li ><a href="index.html?cid=' + data[i].cid + '">' + data[i].cname + '</a></li>'
                }
                $("#category").html(lis);
                var op=""
                for (var i = 0; i < data.length; i++) {
                    op+=`<option value="${data[i].cid}">${data[i].cname}</option>`
                }
                $("#publish_theme").html(op)
            })
        })
        $(function () {
            $("#publish_button").click(function () {
                $.post("/post/publish",$("#form").serialize(),function (pdata) {
                    if(!pdata.flag) {
                        alert(pdata.message)
                        location.href = "login.html"
                    } else {
                        alert(pdata.message)
                        location.href = "index.html"
                    }

                })
            })

        })

    </script>
</head>
<body>
    <div class="top-bar-wrapper clearfix">
        <div class="top-bar">
            <div class="logo">
                <img src="image/logo.jpeg" class="logo-img">
            </div>

            <div class="shortcut">
                <ul id="userInfo">
                    <li>
                        <a href="login.html">用户登录</a>
                    </li>

                    <li>个人中心</li>
                </ul>
            </div>

        </div>
    </div>
    <div class="theme-bar-wrapper">
        <ul class="theme-bar" id="category">

        </ul>
    </div>
    <div class="publish_wrapper">
        <form id="form" accept-charset="UTF-8">
            <div class="publish_title_wrapper">
                <input placeholder="请输入标题（4-40个字）" class="publish_title" name="publish_title">
            </div>
            <div class="publish_content_wrapper">
                <textarea placeholder="从这里开始分享.." class="publish_content" name="publish_content"></textarea>
            </div>
            <div class="publish_theme_wrapper">
                主题&nbsp&nbsp
                <select name="cid" id="publish_theme">

                </select>
            </div>
            <div class="publish_button_wrapper">
                <button type="button" class="publish_button" id="publish_button">发布</button>
            </div>

        </form>

    </div>

</body>
</html>